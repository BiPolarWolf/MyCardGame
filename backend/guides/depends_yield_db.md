–ü–æ–Ω—è–ª —Ç–µ–±—è. –î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º —É–ø–æ—Ä –∏–º–µ–Ω–Ω–æ –Ω–∞ ¬´–¥–≤–∏–∂–æ–∫¬ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. Depends ‚Äî —ç—Ç–æ, –ø–æ–∂–∞–ª—É–π, —Å–∞–º–∞—è –º–æ—â–Ω–∞—è —Ñ–∏—à–∫–∞ FastAPI, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∫–æ–¥ –∏–∑ –º–∞–∫–∞—Ä–æ–Ω –≤ –º–æ–¥—É–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä.

–í–æ—Ç —Ç–≤–æ–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω—ã–π –≥–∞–π–¥ –¥–ª—è .md —Ñ–∞–π–ª–∞.

üèóÔ∏è –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ: FastAPI DI (Depends, Yield, get_db)
1. –ú–µ—Ö–∞–Ω–∏–∫–∞ yield –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ë–î
–ö–æ–≥–¥–∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º yield –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –ø–æ–º–µ—á–µ–Ω–Ω–æ–π –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, FastAPI –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –µ—ë –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä.

Python

def get_db():
    # 1. SETUP: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –î–û –∑–∞–ø—Ä–æ—Å–∞
    db = SessionLocal() 
    try:
        # 2. –ü–ï–†–ï–î–ê–ß–ê: –û–±—ä–µ–∫—Ç db "–≤–ø—Ä—ã—Å–∫–∏–≤–∞–µ—Ç—Å—è" –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç
        yield db 
    finally:
        # 3. TEARDOWN: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ü–û–°–õ–ï –∑–∞–ø—Ä–æ—Å–∞ (–¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞)
        db.close()
–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ?
–ë–µ–∑ –±–ª–æ–∫–∞ finally –∏ yield, –µ—Å–ª–∏ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –ª–æ–≥–∏–∫–∏) –≤—ã–ª–µ—Ç–∏—Ç –æ—à–∏–±–∫–∞, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–∞–∫ –∏ –±—É–¥–µ—Ç –¥–µ—Ä–∂–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–º. –ß–µ—Ä–µ–∑ 100 —Ç–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ —Ç–≤–æ–π —Å–µ—Ä–≤–µ—Ä —Å–∫–∞–∂–µ—Ç: "–ò–∑–≤–∏–Ω–∏, –ª–∏–º–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏—Å—á–µ—Ä–ø–∞–Ω", –∏ —É–ø–∞–¥–µ—Ç.

2. –ß—Ç–æ —Ç–∞–∫–æ–µ Depends –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ?
Depends ‚Äî —ç—Ç–æ –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –≠—Ç–æ —Å–ø–æ—Å–æ–± —Å–∫–∞–∑–∞—Ç—å: "–≠–π, FastAPI, —ç—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏ X".

–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
FastAPI –≤–∏–¥–∏—Ç Depends(get_db).

–û–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: "–Ø —É–∂–µ –∑–∞–ø—É—Å–∫–∞–ª get_db –≤ —Ä–∞–º–∫–∞—Ö –≠–¢–û–ì–û –∑–∞–ø—Ä–æ—Å–∞?".

–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç, –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ next() –∏ –∫—ç—à–∏—Ä—É–µ—Ç –µ–≥–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).

–ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–≤–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç.

3. –ì–¥–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Depends? (–ö–µ–π—Å—ã)
Depends –Ω—É–∂–µ–Ω –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –±–∞–∑—ã. –í–æ—Ç 3 —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è:

–ê. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ (Auth)
–¢—ã –º–æ–∂–µ—à—å —Å–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç ‚Äî –æ–Ω–∞ –∫–∏–¥–∞–µ—Ç –æ—à–∏–±–∫—É –µ—â–µ –î–û —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ª–æ–≥–∏–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞.

Python

def get_current_user(token: str = Header()):
    if token != "secret-key":
        raise HTTPException(status_code=403)
    return {"user": "admin"}

@app.get("/admin-data")
def read_admin_data(user: dict = Depends(get_current_user)):
    return {"data": "top secret"}
–ë. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (Query Params)
–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å 10 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —Ñ—É–Ω–∫—Ü–∏—é —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, —Ç—ã –º–æ–∂–µ—à—å —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ –∫–ª–∞—Å—Å –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é.

Python

def pagination_params(skip: int = 0, limit: int = 10):
    return {"skip": skip, "limit": limit}

@app.get("/items")
def list_items(params: dict = Depends(pagination_params)):
    return params # –ü–æ–ª—É—á–∏–º —Å—Ä–∞–∑—É —Å–ª–æ–≤–∞—Ä—å
–í. –ò–µ—Ä–∞—Ä—Ö–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Chain)
–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

get_db –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫.

get_user –∑–∞–≤–∏—Å–∏—Ç –æ—Ç get_db.

get_admin_rights –∑–∞–≤–∏—Å–∏—Ç –æ—Ç get_user.

FastAPI —Å–∞–º –ø–æ—Å—Ç—Ä–æ–∏—Ç —ç—Ç–æ –¥–µ—Ä–µ–≤–æ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –∏—Ö –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

4. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ —Ä–æ—É—Ç–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ —Ç–æ–∫–µ–Ω –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–ª–∏ –≤—Ä–µ–º—è, —Ç—ã –º–æ–∂–µ—à—å –ø–æ–≤–µ—Å–∏—Ç—å Depends –Ω–∞ –≤–µ—Å—å —Ä–æ—É—Ç–µ—Ä:

Python

router = APIRouter(dependencies=[Depends(verify_token)])
–¢–µ–ø–µ—Ä—å —Ç–µ–±–µ –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å Depends –≤ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –æ–Ω –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

5. –í–∞–∂–Ω–æ–µ: yield + Depends = –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–ü–æ–º–Ω–∏ –≥–ª–∞–≤–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç yield:

–ó–∞–ø—Ä–æ—Å –ø—Ä–∏—à–µ–ª ‚Æï –ó–∞–ø—É—Å–∫ –∫–æ–¥–∞ –¥–æ yield.

–õ–æ–≥–∏–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ ‚Æï –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–≤–æ–µ–π —Ñ—É–Ω–∫—Ü–∏–∏.

–û—Ç–≤–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω ‚Æï –ó–∞–ø—É—Å–∫ –∫–æ–¥–∞ –ø–æ—Å–ª–µ yield (–∑–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤).

–¢–≤–æ–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –ü–æ–ø—Ä–æ–±—É–π —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å get_settings, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—å "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã" –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—á–∏—â–µ–Ω—ã" –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞. –≠—Ç–æ –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø—Ä–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å yield.
